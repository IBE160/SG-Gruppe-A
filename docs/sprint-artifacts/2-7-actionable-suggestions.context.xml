<story-context id="2-7-actionable-suggestions" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>7</storyId>
    <title>Actionable Suggestions</title>
    <status>drafted</status>
    <generatedAt>2025-12-06</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-7-actionable-suggestions.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to receive actionable suggestions for improving my ATS score</iWant>
    <soThat>I can make my CV more competitive.</soThat>
    <tasks>
      <task id="1" ac_ref="1">
        <description>AI Service Suggestion Generation</description>
        <subtask id="1.1">Design AI prompt to generate "actionable suggestions" based on identified gaps and the job description.</subtask>
        <subtask id="1.2">Implement suggestion logic in `app/services/ats_scorer.py` (or similar service module) ensuring response aligns with the `Actionable Suggestions` data contract (Text content).</subtask>
        <subtask id="1.3">Update the `/ai/analyze-and-generate` endpoint response model to include `actionable_suggestions`.</subtask>
      </task>
      <task id="2" ac_ref="1">
        <description>Backend Integration</description>
        <subtask id="2.1">Ensure the backend handles the `actionable_suggestions` field from the AI service response.</subtask>
        <subtask id="2.2">Store the suggestions in the `Results` table (as `actionable_suggestions`).</subtask>
      </task>
      <task id="3" ac_ref="1">
        <description>Frontend Display</description>
        <subtask id="3.1">Create a display component (e.g., `SuggestionsList.tsx` or similar) to present the suggestions clearly (e.g., bulleted list).</subtask>
        <subtask id="3.2">Integrate this component into the results view, adjacent to the ATS score and Gap Analysis.</subtask>
      </task>
      <task id="4" ac_ref="1">
        <description>Testing</description>
        <subtask id="4.1">Unit test the AI prompt/logic to ensure it produces relevant suggestions for test inputs.</subtask>
        <subtask id="4.2">Integration test to verify suggestions flow from AI Service -> Backend -> Frontend.</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">
      <given>an ATS score has been calculated</given>
      <when>the suggestions are displayed</when>
      <then>the system shall provide actionable suggestions to the user for improving their displayed ATS score</then>
    </ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/sprint-artifacts/tech-spec-epic-2.md" description="Technical Specification for Epic 2" section="AC-EL2.6" />
      <doc path="docs/epics.md" description="Epic Breakdown" section="Story-2.7-Actionable-Suggestions" />
      <doc path="docs/architecture.md" description="System Architecture" section="3.3-AI-Service" />
      <doc path="docs/sprint-artifacts/2-6-ats-score-calculation.md" description="Learnings from Previous Story" />
    </docs>
    <code>
      <file path="app/services/ats_scorer.py" description="AI Service logic for suggestion generation" />
      <file path="Results" description="Backend database table for storing suggestions" type="database" />
      <file path="src/components/SuggestionsList.tsx" description="Frontend component for displaying suggestions" />
    </code>
    <dependencies>
      <dependency id="2.6">Story 2.6 (ATS Score Calculation)</dependency>
      <dependency id="2.5">Story 2.5 (Gap Analysis)</dependency>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>AI Service: Follow the pattern of `app/services` modules. Ensure the prompt context includes both the CV gaps and the JD to make suggestions specific.</constraint>
    <constraint>Backend: Python/FastAPI. Update the `Results` model if necessary to store this text field.</constraint>
    <constraint>Frontend: Next.js/Tailwind. Use consistent styling with the existing Gap Analysis display.</constraint>
  </constraints>
  <interfaces>
    <interface type="API" method="POST" endpoint="/ai/analyze-and-generate">
      <description>AI Service API endpoint</description>
      <response_field name="actionable_suggestions" type="string" description="List of suggestions for improving ATS score" />
    </interface>
  </interfaces>
  <tests>
    <standards>
      <standard>Unit test the AI prompt/logic to ensure it produces relevant suggestions for test inputs.</standard>
      <standard>Integration test to verify suggestions flow from AI Service -> Backend -> Frontend.</standard>
    </standards>
    <locations>
      <!-- Specific test file paths will be added during implementation -->
    </locations>
    <ideas>
      <!-- Test cases will be elaborated during implementation -->
    </ideas>
  </tests>
</story-context>