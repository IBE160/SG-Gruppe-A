<story-context id="1-3-user-login" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.3</storyId>
    <title>User Login</title>
    <status>draft</status>
    <generatedAt>2025-12-06</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-3-user-login.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>registered user</asA>
    <iWant>to be able to log in with my email and password</iWant>
    <soThat>I can access my account and saved data</soThat>
    <tasks>
- [ ] Task 1: Implement Backend Login Endpoint (AC: 1)
  - [ ] Subtask 1.1: Create `POST /api/v1/auth/login` endpoint
  - [ ] Subtask 1.2: Implement password verification (using bcrypt)
  - [ ] Subtask 1.3: Implement JWT token generation
  - [ ] Subtask 1.4: Securely return JWT (e.g. HttpOnly cookie)
  - [ ] Subtask 1.5: Create unit tests for login logic (success, invalid credentials)
  - [ ] Subtask 1.6: Create integration test for `/login` endpoint
- [ ] Task 2: Implement Frontend Login Form (AC: 1)
  - [ ] Subtask 2.1: Create Login Page UI
  - [ ] Subtask 2.2: Implement form state and validation
  - [ ] Subtask 2.3: Connect form submission to backend API
  - [ ] Subtask 2.4: Handle successful login (redirect to dashboard)
  - [ ] Subtask 2.5: Handle login errors (display error message)
  - [ ] Subtask 2.6: Create unit/component tests for LoginForm interaction
    </tasks>
  </story>

  <acceptanceCriteria>
1.  Given a user is on the login page
    When they enter their correct email and password
    And they click the "Log In" button
    Then the system authenticates the user
    And a JWT token is returned to the client
    And the user is redirected to their dashboard.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Core Application</title>
        <section>Detailed Design > APIs and Interfaces > Authentication API</section>
        <snippet>POST /api/auth/login: User login. Request: { email, password }. Response: { token, user: { id, email } }</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Specification</title>
        <section>3.2 Backend API</section>
        <snippet>Authentication: JSON Web Tokens (JWT). A stateless and secure method for authenticating users.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>5.1 Critical User Paths > Journey: First-Time User</section>
        <snippet>Entry: User lands on the homepage... Clicks "Get Started", "Log In", or "Sign Up". Authentication: User provides an email and password to sign up or log in.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing code found (Greenfield state for implementation) -->
      <!-- Expected implementation paths -->
      <item>
        <path>backend/routes/auth.js</path>
        <kind>route</kind>
        <symbol>POST /login</symbol>
        <reason>Target file for login endpoint implementation</reason>
      </item>
      <item>
        <path>backend/controllers/authController.js</path>
        <kind>controller</kind>
        <symbol>loginUser</symbol>
        <reason>Target file for login logic (hashing, JWT)</reason>
      </item>
      <item>
        <path>frontend/pages/login.tsx</path>
        <kind>page</kind>
        <symbol>LoginPage</symbol>
        <reason>Target file for login page UI</reason>
      </item>
    </code>
    <dependencies>
      <pkg type="npm">bcrypt</pkg>
      <pkg type="npm">jsonwebtoken</pkg>
      <pkg type="npm">express</pkg>
      <pkg type="npm">react-hook-form</pkg>
      <pkg type="npm">axios</pkg>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Passwords must be verified using bcrypt (or similar secure hashing).</constraint>
    <constraint>JWT tokens must be used for session management.</constraint>
    <constraint>JWT should be stored securely (HttpOnly cookie preferred over localStorage).</constraint>
    <constraint>All auth traffic must be over HTTPS (in production).</constraint>
    <constraint>User data must be encrypted at rest.</constraint>
  </constraints>

  <interfaces>
    <api>
      <name>User Login</name>
      <kind>REST</kind>
      <signature>POST /api/v1/auth/login { email, password } -> { token, user }</signature>
    </api>
  </interfaces>

  <tests>
    <standards>Unit tests for controller logic (mocking DB). Integration tests for API endpoints (using supertest). Component tests for React forms (using React Testing Library).</standards>
    <locations>
      <loc>backend/tests/auth.test.js</loc>
      <loc>frontend/tests/login.test.tsx</loc>
    </locations>
    <ideas>
      <idea ac="1">Verify valid credentials return 200 and JWT.</idea>
      <idea ac="1">Verify invalid email returns 401.</idea>
      <idea ac="1">Verify invalid password returns 401.</idea>
      <idea ac="1">Verify frontend redirects to dashboard on success.</idea>
      <idea ac="1">Verify frontend displays error message on failure.</idea>
    </ideas>
  </tests>
</story-context>
